# DAO Launcher Kit - AI Coding Agent Instructions

This is a modular DAO (Decentralized Autonomous Organization) platform built on the Internet Computer blockchain using Motoko backend canisters and a React frontend.

## Architecture Overview

### Multi-Canister Backend
- **Core Pattern**: Each domain has its own canister (governance, staking, treasury, proposals, assets)
- **Central Coordinator**: `src/dao_backend/main.mo` manages user profiles, admin permissions, and cross-canister references
- **Inter-Canister Communication**: Uses actor references with dependency injection pattern in `dfx.json`
- **State Management**: Stable variables for upgrade-safe storage, transient HashMaps for runtime efficiency

### Frontend-Backend Integration
- **Declarations**: Auto-generated from Candid interfaces via `dfx generate` â†’ `src/dao_frontend/src/declarations/`
- **Agent Configuration**: Environment-based canister IDs, local development uses `http://localhost:4943`
- **Authentication**: Internet Identity integration via `@dfinity/auth-client` in `AuthContext.jsx`

## Development Workflow

### Essential Commands (Always use WSL)
```bash
# Core development cycle
dfx start --clean --background    # Start IC replica
dfx deploy                       # Deploy all canisters
dfx generate                     # Regenerate frontend declarations
cd src/dao_frontend && npm run dev  # Start frontend (port 5173)

# Canister-specific deployment
dfx deploy dao_backend
dfx deploy governance --argument "(principal \"$(dfx canister id dao_backend)\", principal \"$(dfx canister id staking)\")"
```

### Critical Deployment Order
1. `dao_backend` and `staking` first (no dependencies)
2. `governance` with initialization arguments (depends on dao_backend + staking)
3. `treasury`, `proposals`, `assets` (independent)
4. `dao_frontend` last (depends on all backend canisters)

## Code Patterns & Conventions

### Motoko Backend Patterns
```motoko
// Standard canister structure
persistent actor CanisterName {
    // 1. Stable variables for upgrades
    private stable var initialized : Bool = false;
    private stable var dataEntries : [(Key, Value)] = [];
    
    // 2. Transient runtime storage
    private transient var dataMap = HashMap.HashMap<Key, Value>(10, equal, hash);
    
    // 3. Pre/post upgrade hooks
    system func preupgrade() { dataEntries := Iter.toArray(dataMap.entries()) };
    system func postupgrade() { 
        dataMap := HashMap.fromIter(dataEntries.vals(), dataEntries.size(), equal, hash);
        dataEntries := [];
    };
}
```

### Frontend Context Pattern
- **AuthContext**: Manages Internet Identity authentication and principal state
- **DAOContext**: Handles DAO data and operations across components
- **ActorContext**: Provides canister actor instances with proper agent configuration

### Component Architecture
- **Multi-step Forms**: See `LaunchDAO.jsx` - complex wizard with state validation
- **Error Boundaries**: Wrap async operations with try-catch and user feedback
- **Loading States**: Always provide loading indicators for blockchain operations

## Environment Configuration

### Required Environment Variables
```env
# Auto-generated by dfx.json -> .env
VITE_CANISTER_ID_DAO_BACKEND=xxxxx
VITE_CANISTER_ID_GOVERNANCE=xxxxx
VITE_CANISTER_ID_STAKING=xxxxx
VITE_CANISTER_ID_TREASURY=xxxxx
VITE_CANISTER_ID_PROPOSALS=xxxxx
DFX_NETWORK=local
```

### Frontend Build Configuration
- **Vite**: Custom config handles DID files, environment variables, and IC-specific optimizations
- **TailwindCSS**: Utility-first styling with custom theme in `tailwind.config.js`
- **TypeScript**: Strict mode with Candid type generation for type safety

## Integration Points

### Internet Computer Specifics
- **Principal-based Identity**: All user operations use Principal.fromText() conversion
- **Async Actor Calls**: Backend operations are always async with Result<T, Error> patterns
- **Agent Configuration**: Different hosts for local (`localhost:4943`) vs IC mainnet
- **Root Key Fetching**: Required for local development authentication

### Cross-Component Communication
- **Actor References**: Backend canisters store references to other canisters for inter-canister calls
- **Frontend Coordination**: `useDAOOperations.js` orchestrates multi-canister operations
- **State Synchronization**: React Context provides global state, custom hooks handle business logic

## Token Economics & DAO Governance

### Staking Mechanisms
- **Multi-Period Staking**: Instant (no lock), 30/90/180/365 day locks with increasing reward multipliers
- **Voting Power Calculation**: `staked_amount * time_multiplier` - longer locks = more governance influence
- **Reward Distribution**: Continuous compounding with automatic reinvestment
- **Penalty System**: Early unstaking incurs penalties, slashing protection for governance participation

### Governance Patterns
```motoko
// Proposal lifecycle in governance/main.mo
type ProposalStatus = {
    #pending;   // Created, awaiting voting period
    #active;    // Currently accepting votes
    #succeeded; // Passed quorum and approval thresholds
    #failed;    // Did not meet requirements
    #executed;  // Successfully implemented
    #cancelled; // Terminated before completion
};
```

### Voting Mechanisms
- **Token-Weighted**: Proportional to staked amount (default)
- **Quadratic Voting**: Prevents whale dominance via `sqrt(stake)` calculation
- **Delegated Voting**: Users can delegate voting power to representatives
- **Quorum Requirements**: Minimum participation thresholds for proposal legitimacy

### Proposal Types in `shared/types.mo`
- **Text Proposals**: Governance decisions without code execution
- **Treasury Transfers**: Multi-sig controlled fund movements
- **Parameter Changes**: DAO configuration updates (voting periods, thresholds)
- **Membership Changes**: Admin role additions/removals

### Cross-Canister Governance Flow
1. **Proposal Creation**: `governance` canister validates proposer credentials via `dao_backend`
2. **Voting Power**: `governance` queries `staking` for user's current voting weight
3. **Execution**: Successful proposals trigger actions across relevant canisters
4. **Treasury Operations**: `treasury` canister enforces multi-signature requirements

## Common Troubleshooting

### Deployment Issues
```bash
# Reset canister state
dfx canister delete --all
dfx deploy

# Fix governance initialization
dfx deploy governance --argument "(principal \"$(dfx canister id dao_backend)\", principal \"$(dfx canister id staking)\")"
```

### Frontend Development
- **Authentication**: Clear `localStorage` IC keys if auth fails
- **Declarations**: Run `dfx generate` after any backend changes
- **Hot Reload**: Frontend runs on port 5173, proxies IC calls to port 4943

Remember: This platform uses Internet Computer's unique upgrade-safe patterns and principal-based authentication - always consider these constraints when making changes.
